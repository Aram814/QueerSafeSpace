<!DOCTYPE-html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QueerSafeSpace</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#6366f1',
                        secondary: '#94a3b8',
                        background: '#f1f5f9',
                        text: '#1e293b',
                        white: '#ffffff',
                        red: '#ef4444',
                        green: '#22c5e',
                        yellow: '#facc15',
                        signin: '#8F7FFF',
                        signup: '#8EFD17',
                    }
                }
            }
        }
    </script>
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        xintegrity="sha512-iecdLp/Xq/C7xP5Kj8T6hE3p78+kC/K7p+g1k6Qf6d2G9w9a7a9g5tS5K3X/9z7aG6wD9wG8wF2e6y"
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* Global CSS Variables */
        :root {
            --primary: #6366f1;
            --secondary: #94a3b8;
            --background: #f1f5f9;
            --text: #1e293b;
            --white: #ffffff;
            --red: #ef4444;
            --green: #22c5e;
            --yellow: #facc15;
            --find-space-blue: #1272EF; /* Added new color variable */
        }

        /* Base Body and Container Styles */
        body {
            font-family: 'Inter', sans-serif;
            color: var(--text);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            background: linear-gradient(
                to right,
                rgba(255, 0, 0, 0.55),
                rgba(255, 144, 7, 0.55),
                rgba(251, 255, 0, 0.55),
                rgba(0, 250, 0, 0.55),
                rgba(0, 255, 238, 0.55),
                rgba(21, 0, 255, 0.55),
                rgba(106, 0, 255, 0.55),
                rgba(255, 0, 183, 0.55)
            );
        }

        /* Screen Transitions and Layouts */
        .screen {
            display: none;
            position: absolute; /* Changed to absolute to stack them */
            top: 0;
            left: 0;
            width: 100%;
            min-height: 100vh;
            overflow-y: auto;
            animation: fadeIn 0.5s ease-in-out;
            z-index: 10;
        }

        .screen.active {
            display: flex;
            flex-direction: column;
        }
        
        /* Unique Backgrounds for Each Page */
        .screen::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.55;
            z-index: 1; /* Ensure background is behind content */
        }
        
        #map {
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* Frosted Glass Card Effect */
        .content-card {
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            z-index: 2; /* Ensure card content is above background */
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            padding: 2rem;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .modal-content-with-close {
            position: relative;
        }
        .modal-close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.5rem;
            color: #6b7280;
            cursor: pointer;
        }
        /* Floating Action Buttons */
        #fab {
            position: absolute;
            bottom: 2rem;
            left: 2rem;
            width: 60px;
            height: 60px;
            background-color: rgb(138, 63, 252);
            color: var(--white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: transform 0.2s ease-in-out;
            z-index: 1000;
        }

        #fab:active {
            transform: scale(0.95);
        }

        #crisis-button {
            padding: 0.75rem 1.5rem;
            background-color: var(--red);
            color: var(--white);
            border-radius: 9999px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: transform 0.2s ease-in-out;
            font-weight: 600;
        }

        #crisis-button:active {
            transform: scale(0.95);
        }
        
        /* Landing Page Specifics */
        .landing-logo {
            width: 200px;
            height: auto;
            margin-bottom: 2rem;
        }

        /* Side Menu and Toggle */
        #hamburger-menu-btn {
            position: absolute;
            top: 1rem;
            left: 1rem;
            z-index: 1001; /* Above the map */
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            padding: 0.75rem;
            border-radius: 9999px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        #side-menu {
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
            z-index: 2000;
        }

        #side-menu.open {
            transform: translateX(0);
        }

        #side-menu .menu-content {
            width: 75%;
            max-width: 300px;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            padding: 2rem;
            box-shadow: 4px 0 8px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
        }
        
        #side-menu a {
            padding: 1rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s;
        }

        #side-menu a:hover {
            background-color: var(--background);
        }

        /* Custom Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 28px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: #80FD91;
        }

        input:checked+.slider:before {
            transform: translateX(22px);
        }

        #map-container {
            flex-grow: 1;
            position: relative;
            padding: 4px;
            min-height: 0; /* Important for flex-grow in column */
        }

        /* Map key styling */
        .map-key-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            font-size: 0.8rem;
            color: #6b7280;
            text-align: center;
        }

        .map-key-item {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .color-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        /* Content pages styling */
        .content-container {
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
            text-align: left;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        .content-container h2 {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }
        .content-container h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
        }
        .content-container p, .content-container ul {
            margin-bottom: 1rem;
            color: #4b5563;
        }
        .content-container strong {
            font-weight: bold;
        }

        /* Main Screen Specifics */
        #main-screen {
            position: relative; /* Set to relative for positioning children */
            display: flex;
            flex-direction: column;
            overflow: hidden;
            height: 100vh;
        }

        #main-screen .top-controls {
            z-index: 1000; /* Ensure this is on top of the map */
            position: relative;
            background-color: rgba(255, 255, 255, 0.5); /* Use a semi-transparent background */
        }

        #main-screen .bottom-controls {
            z-index: 1000; /* Ensure this is on top of the map */
            position: relative;
            background-color: rgba(255, 255, 255, 0.5); /* Use a semi-transparent background */
        }
        
        .avatar-container {
            background-color: rgba(243, 244, 246, 0.8);
            border-radius: 12px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .avatar-selection-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px;
        }
        
        .avatar-option {
            font-size: 2rem;
            cursor: pointer;
            opacity: 0.6;
            transition: opacity 0.2s, transform 0.2s;
            text-align: center;
            padding: 4px;
            border-radius: 50%;
        }
        
        .avatar-option:hover {
            transform: scale(1.1);
            opacity: 1;
        }
        
        .avatar-option.selected {
            opacity: 1;
            border: 2px solid var(--primary);
            border-radius: 50%;
            transform: scale(1.1);
        }

        .form-message {
            margin-top: 1rem;
            text-align: center;
            font-size: 0.875rem;
        }

        /* Add this for the avatar in the menu */
        .menu-avatar {
            font-size: 2.5rem;
            margin-right: 0.5rem;
            display: inline-block;
            transition: transform 0.2s ease;
        }
    </style>
</head>

<body>
    <div id="app-container">
        <!-- Splash Screen -->
        <div id="splash-screen" class="screen active p-8 flex flex-col items-center justify-start pt-20">
            <div class="content-card w-full max-w-xl flex flex-col items-center">
                <img src="https://raw.githubusercontent.com/Aram814/QueerSafeSpace/refs/heads/main/IMG_9650.PNG"
                    alt="QueerSafeSpace Logo" class="landing-logo">
                <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-center">QueerSafeSpace</h1>
                <p class="text-gray-500 text-lg mt-2 text-center">Because Safety Shouldn‚Äôt Be A Privilege</p>
                <p class="text-sm text-center text-gray-700 mt-4 max-w-sm">QueerSafeSpace is a community-driven app for the LGBTQ+ community to find and share safe, inclusive spaces. This is not a dating or social networking app. Your contributions are anonymous, fostering a truly safe and supportive environment.</p>
                <div class="mt-8 w-full flex flex-col gap-4">
                    <button id="sign-in-btn"
                        class="px-6 py-3 rounded-full font-semibold transition-all duration-300 transform hover:scale-105 w-full" style="background-color: #8F7FFF; color: white;">Sign
                        in</button>
                    <button id="sign-up-btn"
                        class="px-6 py-3 rounded-full font-semibold transition-all duration-300 transform hover:scale-105 w-full" style="background-color: #8EFD17; color: white;">Sign
                        up</button>
                    <p class="text-sm text-gray-500 mt-2 text-center">The app is fully anonymous to protect all users.
                        However, without an account, saved data is limited resulting in limited features.</p>
                </div>
            </div>
        </div>

        <!-- Main App Screen (Map) -->
        <div id="main-screen" class="screen flex-col">
            <!-- Top Controls -->
            <div class="top-controls w-full flex flex-col items-center">
                <button id="hamburger-menu-btn" class="text-primary text-xl" aria-label="Open side menu">
                    <i class="fa-solid fa-bars"></i>
                </button>
                <!-- Logo and App Name -->
                <div class="flex items-center justify-center p-4">
                    <img src="https://raw.githubusercontent.com/Aram814/QueerSafeSpace/refs/heads/main/IMG_9650.PNG"
                        alt="QueerSafeSpace Logo" class="h-10 w-10 mr-2">
                    <h1 class="text-2xl font-bold">QueerSafeSpace</h1>
                </div>

                <!-- Search and Filter Container -->
                <div class="flex w-full px-4 max-w-xl mx-auto space-x-2">
                    <div id="search-container" class="relative flex-grow shadow-md rounded-full overflow-hidden">
                        <label for="search-input" class="sr-only">Search</label>
                        <input type="text" id="search-input" placeholder="Search for safe spaces..."
                            class="w-full px-6 py-3 rounded-full border-2 border-transparent focus:outline-none focus:border-primary transition-colors">
                        <i class="fas fa-search absolute right-6 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    </div>
                    <button id="filter-btn" class="p-3 rounded-full bg-white shadow-md text-primary">
                        <i class="fa-solid fa-filter"></i>
                    </button>
                </div>
            </div>

            <!-- Map Container -->
            <div id="map-container" class="flex-grow p-4">
                <div id="map" class="w-full h-full rounded-xl shadow-lg border-2 border-gray-200"></div>
                <button id="fab" aria-label="Add a new safe space">
                    <i class="fa-solid fa-plus text-2xl"></i>
                </button>
            </div>

            <!-- Bottom Controls -->
            <div class="bottom-controls w-full">
                <!-- Map Key -->
                <div class="w-full py-2 map-key-container">
                    <div class="map-key-item">
                        <div class="color-dot" style="background-color: #19CA2E;"></div>
                        <span>Safe</span>
                    </div>
                    <div class="map-key-item">
                        <div class="color-dot" style="background-color: #F3F318;"></div>
                        <span>Mixed</span>
                    </div>
                    <div class="map-key-item">
                        <div class="color-dot" style="background-color: #FF0000;"></div>
                        <span>Not Safe</span>
                    </div>
                    <div class="map-key-item">
                        <div class="color-dot" style="background-color: #D9D9D9;"></div>
                        <span>Unknown</span>
                    </div>
                </div>

                <!-- Action Buttons below map -->
                <div class="flex justify-between w-full p-4">
                    <button id="find-safe-space-btn" class="px-6 py-3 rounded-full font-semibold text-white transition-all duration-300 transform hover:scale-105" style="background-color: #1272EF;">
                        Find My Safe Space
                    </button>
                    <button id="crisis-button" class="px-6 py-3 rounded-full font-semibold text-white transition-all duration-300 transform hover:scale-105 bg-red">
                        Crisis Button
                    </button>
                </div>
            </div>
        </div>

        <!-- Account Settings Screen -->
        <div id="account-settings-screen" class="screen justify-start items-center p-8">
            <div class="content-card w-full max-w-xl">
                <h2 class="text-2xl font-bold mb-4 text-center">Account Settings</h2>
                
                <h3 class="text-lg font-bold mb-2">Change Avatar</h3>
                <div class="flex flex-col items-center mb-4">
                    <span id="current-avatar" class="text-6xl mb-4">üè≥Ô∏è‚Äçüåà</span>
                    <div class="avatar-container">
                        <div id="avatar-selection-grid" class="avatar-selection-grid">
                            <span class="avatar-option" data-avatar="üè≥Ô∏è‚Äçüåà">üè≥Ô∏è‚Äçüåà</span>
                            <span class="avatar-option" data-avatar="üè≥Ô∏è‚Äç‚ößÔ∏è">üè≥Ô∏è‚Äç‚ößÔ∏è</span>
                            <span class="avatar-option" data-avatar="üë©">üë©</span>
                            <span class="avatar-option" data-avatar="üë®">üë®</span>
                            <span class="avatar-option" data-avatar="üßë">üßë</span>
                            <span class="avatar-option" data-avatar="‚ù§Ô∏è">‚ù§Ô∏è</span>
                            <span class="avatar-option" data-avatar="üß°">üß°</span>
                            <span class="avatar-option" data-avatar="üíõ">üíõ</span>
                            <span class="avatar-option" data-avatar="üíö">üíö</span>
                            <span class="avatar-option" data-avatar="üíô">üíô</span>
                            <span class="avatar-option" data-avatar="üíú">üíú</span>
                            <span class="avatar-option" data-avatar="ü©µ">ü©µ</span>
                            <span class="avatar-option" data-avatar="ü©∑">ü©∑</span>
                            <span class="avatar-option" data-avatar="ü§ç">ü§ç</span>
                            <span class="avatar-option" data-avatar="üñ§">üñ§</span>
                        </div>
                    </div>
                </div>
                
                <h3 class="text-lg font-bold mb-2">Change Username</h3>
                <form id="username-form" class="space-y-4 mb-8">
                    <div>
                        <label for="new-username" class="block text-sm font-medium text-gray-700">Username</label>
                        <input type="text" id="new-username"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary"
                            placeholder="Your new username">
                    </div>
                    <div id="username-message" class="form-message hidden"></div>
                    <button type="submit"
                        class="w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                        Update Username
                    </button>
                </form>

                <h3 class="text-lg font-bold mb-2">Change Email</h3>
                <form id="email-form" class="space-y-4 mb-8">
                    <div>
                        <label for="new-email" class="block text-sm font-medium text-gray-700">New Email</label>
                        <input type="email" id="new-email"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary"
                            placeholder="your-new-email@example.com">
                    </div>
                    <div>
                        <label for="confirm-email" class="block text-sm font-medium text-gray-700">Confirm Email</label>
                        <input type="email" id="confirm-email"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary"
                            placeholder="your-new-email@example.com">
                    </div>
                    <div id="email-message" class="form-message hidden"></div>
                    <button type="submit"
                        class="w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                        Update Email
                    </button>
                </form>

                <h3 class="text-lg font-bold mb-2">Change Password</h3>
                <form id="password-form" class="space-y-4 mb-8">
                    <div>
                        <label for="current-password" class="block text-sm font-medium text-gray-700">Current Password</label>
                        <input type="password" id="current-password"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary">
                    </div>
                    <div>
                        <label for="password-new" class="block text-sm font-medium text-gray-700">New Password</label>
                        <input type="password" id="password-new"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary">
                        <p class="text-xs text-gray-500 mt-1">Minimum 8 characters.</p>
                    </div>
                    <div>
                        <label for="confirm-password-new" class="block text-sm font-medium text-gray-700">Confirm New Password</label>
                        <input type="password" id="confirm-password-new"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary">
                    </div>
                    <div id="password-message" class="form-message hidden"></div>
                    <button type="submit"
                        class="w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                        Update Password
                    </button>
                </form>

                <button id="back-to-map-btn" class="mt-8 px-6 py-3 rounded-full font-semibold bg-primary text-white w-full">Back to Map</button>
            </div>
        </div>

        <!-- Contact Us Screen -->
        <div id="contact-us-screen" class="screen justify-center items-center p-8">
            <div class="content-card text-center">
                <h2 class="text-2xl font-bold mb-4">Contact Us</h2>
                <p class="text-gray-600 mb-4">
                    QueerSafeSpace is a community-driven project dedicated to providing a safer environment for LGBTQ+ individuals.
                </p>
                <div class="flex flex-col items-center space-y-2 mt-4">
                    <a href="mailto:queersafespace.lgbt@gmail.com" class="text-primary hover:underline"><i class="fa-solid fa-envelope mr-2"></i> QueerSafeSpace.lgbt@gmail.com</a>
                    <a href="https://www.instagram.com/queersafespace.lgbt?igsh=OHkxbzkxaWdxOGRu" class="text-primary hover:underline"><i class="fa-brands fa-instagram mr-2"></i> @QueerSafeSpace.LGBT</a>
                </div>
                <button id="close-contact-btn" class="mt-8 px-6 py-3 rounded-full font-semibold bg-primary text-white">Close</button>
            </div>
        </div>

        <!-- Privacy Policy Screen -->
        <div id="privacy-policy-screen" class="screen flex-col items-center p-8">
            <div class="content-card w-full max-w-xl text-left">
                <h2 class="text-center font-bold text-2xl mb-4">Privacy Policy</h2>
                <div class="prose max-w-none text-gray-600 leading-relaxed text-sm overflow-y-auto max-h-[60vh]">
                    <p>Effective Date: September 13, 2025</p>
                    <p>QueerSafeSpace respects your privacy. We collect account info, location data (optional), and usage data.</p>
                    <!-- Content abbreviated for brevity as per your template -->
                </div>
                <div class="text-center mt-8">
                    <button class="px-6 py-3 rounded-full font-semibold bg-primary text-white" id="close-privacy-btn">Close</button>
                </div>
            </div>
        </div>


        <!-- Terms and Conditions Screen -->
        <div id="terms-conditions-screen" class="screen flex-col items-center p-8">
            <div class="content-card w-full max-w-xl text-left">
                <h2 class="text-center font-bold text-2xl mb-4">Terms & Conditions</h2>
                <div class="prose max-w-none text-gray-600 leading-relaxed text-sm overflow-y-auto max-h-[60vh]">
                    <p>Effective Date: September 13, 2025</p>
                    <p>By using QueerSafeSpace, you agree to these Terms. You must be at least 13 years old.</p>
                    <!-- Content abbreviated for brevity as per your template -->
                </div>
                <div class="text-center mt-8">
                    <button class="px-6 py-3 rounded-full font-semibold bg-primary text-white" id="close-terms-btn">Close</button>
                </div>
            </div>
        </div>


        <!-- Auth Modal -->
        <div id="auth-modal" class="modal-overlay">
            <div class="modal-content">
                <h2 id="auth-title" class="text-2xl font-bold mb-4"></h2>
                <form id="auth-form" class="space-y-4">
                    <div>
                        <label for="auth-email" class="block text-sm font-medium text-gray-700">Email</label>
                        <input type="email" id="auth-email"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary"
                            placeholder="you@example.com">
                    </div>
                    <div id="password-fields">
                        <div>
                            <label for="auth-password" class="block text-sm font-medium text-gray-700">Password</label>
                            <input type="password" id="auth-password"
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary">
                            <p id="password-requirements-text" class="text-xs text-gray-500 mt-1 hidden">Password must be a minimum of 8 characters.</p>
                        </div>
                        <div id="confirm-password-container" class="mt-4 hidden">
                            <label for="auth-confirm-password" class="block text-sm font-medium text-gray-700">Confirm Password</label>
                            <input type="password" id="auth-confirm-password"
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary">
                        </div>
                    </div>
                    <div id="agreements-container" class="space-y-2 text-sm text-gray-400 hidden">
                        <div class="flex items-start">
                            <input type="checkbox" id="terms" name="terms" class="mr-2 mt-1 rounded text-purple-600 focus:ring-purple-500">
                            <label for="terms" class="text-gray-700">I agree to the <a href="#" class="text-primary hover:underline" id="terms-link">Terms and Conditions</a></label>
                        </div>
                        <div class="flex items-start">
                            <input type="checkbox" id="privacy" name="privacy" class="mr-2 mt-1 rounded text-purple-600 focus:ring-purple-500">
                            <label for="privacy" class="text-gray-700">I agree to the <a href="#" class="text-primary hover:underline" id="privacy-link">Privacy Policy</a></label>
                        </div>
                    </div>
                    <a href="#" id="forgot-password-link" class="text-sm text-primary hover:underline hidden">Forgot password?</a>
                    <button id="submit-auth-btn" type="submit"
                        class="w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                        <span id="auth-button-text"></span>
                    </button>
                </form>
                <div id="auth-message" class="mt-4 text-center"></div>
                <button id="close-auth-modal" class="mt-4 w-full text-sm text-gray-500 hover:text-gray-700">Cancel</button>
            </div>
        </div>

        <!-- Coming Soon Modal -->
        <div id="coming-soon-modal" class="modal-overlay">
            <div class="modal-content modal-content-with-close">
                <button id="close-coming-soon-btn" class="modal-close-btn">&times;</button>
                <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">Feature Coming Soon!</h2>
                <p class="text-gray-600 mb-4 text-center">This feature is currently under development.</p>
            </div>
        </div>


        <!-- Sidebar Menu -->
        <div id="side-menu">
            <div class="menu-content flex flex-col p-8 bg-white">
                <button id="close-menu-btn" class="self-end text-2xl text-gray-500">&times;</button>
                <div class="flex items-center space-x-2 mb-6">
                    <span id="menu-avatar" class="text-4xl">üè≥Ô∏è‚Äçüåà</span>
                    <h3 id="user-name" class="text-2xl font-bold">User Name</h3>
                </div>
                <a href="#" class="mb-2 text-gray-700 font-semibold" data-screen="account-settings-screen">
                    <i class="fa-solid fa-user-cog mr-2"></i> Account Settings
                </a>
                <div class="flex items-center justify-between mb-2 p-2 rounded-md hover:bg-gray-100 transition-colors">
                    <span class="text-gray-700 font-semibold">
                        <i class="fa-solid fa-shield-alt mr-2"></i> Crisis Mode Settings
                    </span>
                    <span class="text-xs text-gray-400 italic">Coming Soon</span>
                </div>
                <hr class="border-t border-gray-200 my-2">
                <a href="#" class="mb-2 text-gray-700 font-semibold" data-screen="contact-us-screen">
                    <i class="fa-solid fa-headset mr-2"></i> Contact Us!
                </a>
                <a href="#" class="mb-2 text-gray-700 font-semibold" data-screen="privacy-policy-screen">
                    <i class="fa-solid fa-lock mr-2"></i> Privacy Policy
                </a>
                <a href="#" class="mb-2 text-gray-700 font-semibold" data-screen="terms-conditions-screen">
                    <i class="fa-solid fa-file-contract mr-2"></i> Terms and Conditions
                </a>
                <div class="mt-auto">
                    <hr class="border-t-2 border-gray-200 my-4">
                    <button id="sign-out-btn" class="w-full text-left py-2 px-4 rounded-md text-gray-700 font-semibold">
                        <i class="fa-solid fa-right-from-bracket mr-2"></i> Log out
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.43.2/+esm';

        // --- Supabase Configuration ---
        const supabaseUrl = 'https://sgvxsyvqluhivohypkkg.supabase.co';
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNndnhzeXZxbHVoaXZvaHlwa2tnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3MjYzNzIsImV4cCI6MjA3MzMwMjM3Mn0.igseAZIczG6fEdtPNuF3_xyXb3rFKh5nQxxO_YUyCEs';
        const supabase = createClient(supabaseUrl, supabaseAnonKey);
        
        // --- Map Initialization (LEAFLET) ---
        let map;
        let mapLoaded = false;

        function initMap() {
            if (mapLoaded) {
                map.invalidateSize();
                return;
            }

            // Initialize Leaflet map
            map = L.map('map', { zoomControl: false }).setView([28.74, -82.49], 10);

            // Add OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(map);

            // Move zoom controls to bottom right
            L.control.zoom({ position: 'bottomright' }).addTo(map);

            // Try to locate user
            map.locate({setView: true, maxZoom: 14});

            mapLoaded = true;
        }

        // --- Search Implementation (Simple Leaflet Geocoder logic) ---
        const searchInput = document.getElementById('search-input');
        searchInput.addEventListener('keypress', async (e) => {
            if (e.key === 'Enter') {
                const query = searchInput.value;
                if (!query) return;
                
                try {
                    const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}`);
                    const data = await response.json();
                    if (data && data.length > 0) {
                        const result = data[0];
                        map.setView([result.lat, result.lon], 15);
                        L.marker([result.lat, result.lon]).addTo(map)
                            .bindPopup(result.display_name).openPopup();
                    }
                } catch (err) {
                    console.error("Search error:", err);
                }
            }
        });

        // --- Screen & Modal Management ---
        const screens = document.querySelectorAll('.screen');
        const modals = document.querySelectorAll('.modal-overlay');

        function showScreen(screenId) {
            screens.forEach(s => {
                s.classList.remove('active');
                s.style.display = 'none';
            });
            const target = document.getElementById(screenId);
            if (target) {
                target.classList.add('active');
                target.style.display = 'flex';
                
                if (screenId === 'main-screen') {
                    // Small timeout to ensure container has dimensions
                    setTimeout(initMap, 100);
                }
            }
        }

        function showModal(id) { document.getElementById(id).style.display = 'flex'; }
        function hideModal(id) { document.getElementById(id).style.display = 'none'; }

        // --- Supabase Logic & Event Binding ---
        let currentUserId = null;
        let modalMode = 'signin';

        const authForm = document.getElementById('auth-form');
        const authEmail = document.getElementById('auth-email');
        const authPassword = document.getElementById('auth-password');
        const authConfirmPassword = document.getElementById('auth-confirm-password');
        const authMessage = document.getElementById('auth-message');
        const userNameElement = document.getElementById('user-name');
        const currentAvatarElement = document.getElementById('current-avatar');
        const menuAvatar = document.getElementById('menu-avatar');

        // Bind all UI buttons
        document.getElementById('sign-in-btn').onclick = () => { setModalMode('signin'); showModal('auth-modal'); };
        document.getElementById('sign-up-btn').onclick = () => { setModalMode('signup'); showModal('auth-modal'); };
        document.getElementById('close-auth-modal').onclick = () => hideModal('auth-modal');
        document.getElementById('hamburger-menu-btn').onclick = () => document.getElementById('side-menu').classList.add('open');
        document.getElementById('close-menu-btn').onclick = () => document.getElementById('side-menu').classList.remove('open');
        document.getElementById('sign-out-btn').onclick = () => supabase.auth.signOut();
        document.getElementById('back-to-map-btn').onclick = () => showScreen('main-screen');
        document.getElementById('close-contact-btn').onclick = () => showScreen('main-screen');
        document.getElementById('close-privacy-btn').onclick = () => showScreen('main-screen');
        document.getElementById('close-terms-btn').onclick = () => showScreen('main-screen');
        document.getElementById('find-safe-space-btn').onclick = () => showModal('coming-soon-modal');
        document.getElementById('crisis-button').onclick = () => showModal('coming-soon-modal');
        document.getElementById('close-coming-soon-btn').onclick = () => hideModal('coming-soon-modal');

        // Nav Links in sidebar
        document.querySelectorAll('#side-menu a').forEach(link => {
            link.onclick = (e) => {
                e.preventDefault();
                showScreen(link.dataset.screen);
                document.getElementById('side-menu').classList.remove('open');
            };
        });

        function setModalMode(mode) {
            modalMode = mode;
            document.getElementById('auth-title').innerText = mode === 'signin' ? 'Sign In' : 'Sign Up';
            document.getElementById('auth-button-text').innerText = mode === 'signin' ? 'Sign In' : 'Sign Up';
            document.getElementById('confirm-password-container').classList.toggle('hidden', mode === 'signin');
            document.getElementById('agreements-container').classList.toggle('hidden', mode === 'signin');
            document.getElementById('password-requirements-text').classList.toggle('hidden', mode === 'signin');
            document.getElementById('forgot-password-link').classList.toggle('hidden', mode === 'signup');
        }

        authForm.onsubmit = async (e) => {
            e.preventDefault();
            const email = authEmail.value;
            const password = authPassword.value;
            
            authMessage.innerText = "Processing...";

            if (modalMode === 'signup') {
                const { data, error } = await supabase.auth.signUp({ email, password });
                if (error) authMessage.innerText = error.message;
                else authMessage.innerText = "Success! Please check your email.";
            } else {
                const { error } = await supabase.auth.signInWithPassword({ email, password });
                if (error) authMessage.innerText = error.message;
                else hideModal('auth-modal');
            }
        };

        // Auth state change handler
        supabase.auth.onAuthStateChange(async (event, session) => {
            if (session) {
                currentUserId = session.user.id;
                userNameElement.innerText = session.user.email.split('@')[0];
                showScreen('main-screen');
            } else {
                currentUserId = null;
                showScreen('splash-screen');
            }
        });

        // Initialize Check
        (async () => {
            const { data: { session } } = await supabase.auth.getSession();
            if (session) showScreen('main-screen');
            else showScreen('splash-screen');
        })();
    </script>
</body>
</html>
